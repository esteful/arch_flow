---
title: 'Example using RBPottery dataset from CRAN Archdata package: Exploratory analysis
  of archaeological ceramic compositions'
output:
  html_notebook:
    toc: yes
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

##Summary

The current dataset used correspond to majolica pottery from Spain 


## Dataset Description

The majolica_df which is a a dataset containing results of chemical analyses of 37 specimens of Majolica pottery from 4 different provenances. 

A data frame with 37 observations on the following variables:

*Al2O3,P2O5,Na2O,MgO,SiO2,K2O,CaO,SiO2,MnO,Fe2O3,Rb,Sr,Pb,Sn,Zr,Nb,Cs,Ba,La,Ce,Pr,Nd,Sm,Eu,Gd,Tb,Dy,Ho,Er,Tm,Yb,Lu,Hf,Ta,Th,U,V,Cr,Co,Ni,Cu,Zn

**Details**:


**Source**:



**References**

Baxter, M. J. 2003. Statistics in Archaeology. Arnold.

Tubb, A., A. J. Parker, and G. Nickless. 1980. The Analysis of Romano-British Pottery by Atomic
Absorption Spectrophotometry. Archaeometry 22: 153-71.



## Install and load packages and functions
```{r}
source('../../install.R')
```


### Load RBPottery from Archdata pachage (example data). Alternatively, import csv
```{r}
read.csv("../DATA/majolica_data.csv", sep = ";") -> df_majolica
```


###Declare df_raw and df_chem, and set the row.names
```{r}
  row.names(df_majolica) <- df_majolica[,1]
  df_raw <- df_majolica  #we are calling to the whole dataset
  df_chem <- df_majolica[,-c(1:2)] #ignore all the columns containing categorical data, 9 in this case. 
```

###Check the structure of the new dataset (skip if desired)
```{r}
  str(df_raw)
```
In df_chem only integers (int) or nummerical (num). Num class contain decimmals 
```{r}
  str(df_chem)
```


###Boxplot with the concentrations

Elemental distribution of the chemical elements
```{r}
  for (i in 1:ncol(df_chem)){
  .datt <- data.frame(GRUPO=df_raw$GRUPO, i= df_chem[,i])
  plot(ggplot(.datt, aes(x= GRUPO, y = i, fill=GRUPO)) + geom_boxplot() + ylab(colnames(df_chem)[i]))
  }
```

###Create categories based on the calcium content or any other condition (optional)
```{r}
  df_raw$Calcareous <- c() #Crete the desrired column
  
  "Non-Calcareous (<%6CaO)" ->   df_raw$Calcareous[df_raw$CaO < 6]
  "Calcareous (>%6CaO)" ->       df_raw$Calcareous[df_raw$CaO> 6]
  "High Calcareous (>%20CaO)" -> df_raw$Calcareous[df_raw$CaO > 20]
   
  df_raw$Calcareous <- as.factor(df_raw$Calcareous)  #bring back to factors
```


We might want to have a glance at how is the calcium content of the samples (two options)
```{r}
df_raw[,c("CaO", "Calcareous")]
select(df_raw,c(CaO,Calcareous)) 
```
##Applying statistics to the dataset

###Variation Matrix
```{r}
arch_varmat(df_chem)
```





###Graphically: Variation Matrix (MVC) plot, MVC dendrogram and CodaDendrogram
```{r}
arch_uniformity(df_chem)
```

###Scatter plot Matrix
```{r}
  #!!select this with the variables to use 
  vars <- c("MnO","CaO","Na2O", "TiO2","BaO", "Al2O3") 
  #!! select the name of the cateogires to plot
  group <- "Region" #e.g "Region", "Kiln"...

  #alr conversion
  alr(df_chem,ivar = 2)-> df_alr
  cbind(df_raw[,1:3],df_alr) -> df_alr

  arch_scatter_matrix(df_raw=df_alr, vars, group, title= "RBPottery")
  #a pdf file is saved in the working directory
```

###Cluster Analysis

Create the dendrograms based on the clr data. Required: define df_chem for numerical df_raw whole dataset (containing categorical data). If desired the emf and pdf can be directly saved to the local folder turning the argument of printDendro = TRUE, by default is false.

nplot: is the vector of plots to be displayed. Chose the index of categorical columns to be displayed. 

```{r}
arch_dendro(df_chem = df_chem, df_raw = df_raw, printDendro = FALSE, nplot=c(2,3))
```




###Principal Component Analysis 

For the alr transformation, the less variable element is generated in arch_uniformity and saved as .lvar.
Here ".lvar" is read automatically. 
nplot: is the vector of plots to be displayed. Chose the index of categorical columns to be displayed. 
printPCA = TRUE for generating pdf and emf files. 


#arch_PCA(df_chem, df_raw =df_raw,lvar=.lvar, nplot=c(2,3)) #nplot is the vector containing categories to be shown

### Principal Component Analysis (alr) without CaO, Mg, Sr, Ni

```{r}
arch_PCA(df_chem, df_raw =df_raw, printPCA= TRUE, labels = FALSE, nplot = c(2,3), shape_cat_number = 2)
```


###Heatmap (table with the concentrations)
```{r}
arch_heatmap(df_chem)
```

###Ternary Diagram

In ArchFlow a ternary diagram is included, where the values of CaO, \ch Al2O3 and \ch SiO2 are included in a single plot. However, as for the Tubbs's dataset the \ch SiO2 is not provided there is no chance to generate these kind of plots. See the ternary diagram of the case study instead. 

```{r}
arch_triangles(df_raw, grup =2) #grup = indicates the column from which the factors will be for the legend 
```

###Outlier detection 
Through the boxplot functions outliers can be removed. 
In this case, TiO2 is chosen to be removed as a variable in order to asses that the groupping remmains similar and therefore, being able to assingn a group to CA4 sample, which is the one outliying due to the value of TiO2. This value, has been reported as a typographic error before by the ArchData package creator. 


###Final Remarks

```{r}
message("This is the first step of the ArchFlow workflow")
```




